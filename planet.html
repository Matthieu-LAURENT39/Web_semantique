<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Info</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .temperature-bar {
            position: relative;
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, blue, red);
            border-radius: 10px;
        }

        .temp-marker {
            position: absolute;
            top: -5px;
            width: 10px;
            height: 30px;
            background: black;
            border-radius: 5px;
        }

        .temp-scale {
            position: relative;
            width: 100%;
            height: 20px;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .temp-scale-mark {
            position: absolute;
            width: 2px;
            height: 10px;
            background: #666;
            transform: translateX(-50%);
        }

        .temp-scale-label {
            position: absolute;
            transform: translateX(-50%);
            top: 12px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>

<body class="bg-gray-100 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Planet Navigation -->
        <nav class="bg-white p-4 shadow-md rounded-md mb-4">
            <ul class="flex justify-center space-x-6">
                <li>
                    <a href="?planetName=Mercury_(planet)"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Mercury</a>
                </li>
                <li>
                    <a href="?planetName=Venus"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Venus</a>
                </li>
                <li>
                    <a href="?planetName=Earth"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Earth</a>
                </li>
                <li>
                    <a href="?planetName=Mars"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Mars</a>
                </li>
                <li>
                    <a href="?planetName=Jupiter"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Jupiter</a>
                </li>
                <li>
                    <a href="?planetName=Saturn"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Saturn</a>
                </li>
                <li>
                    <a href="?planetName=Uranus"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Uranus</a>
                </li>
                <li>
                    <a href="?planetName=Neptune"
                        class="text-gray-700 hover:text-blue-600 hover:underline transition-colors">Neptune</a>
                </li>
            </ul>
        </nav>

        <div class="bg-white p-6 shadow-md rounded-md mb-4">
            <h1 class="text-2xl font-bold text-center mb-4">Planet Information</h1>
            <h2 class="text-xl font-bold text-center mb-4" id="planet-name"></h2>
            <div id="planet-abstract-info" class="mb-4 text-center text-gray-700 italic"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
            <!-- Selected Planet Temperature -->
            <div class="bg-white p-6 shadow-md rounded-md">
                <h3 class="text-lg font-bold text-center mb-4" id="planet-temp-title"></h3>
                <div id="planet-temperature-info"></div>
            </div>

            <!-- Earth Temperature -->
            <div class="bg-white p-6 shadow-md rounded-md">
                <h3 class="text-lg font-bold text-center mb-4">Earth Temperature</h3>
                <div id="earth-temperature-info"></div>
            </div>
        </div>

        <div class="bg-white p-6 shadow-md rounded-md">
            <h2 class="text-lg font-semibold mb-4">Comparison Information</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-2 text-left">Property</th>
                            <th class="px-4 py-2 text-left" id="planet-table-header"></th>
                            <th class="px-4 py-2 text-left">Earth</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-table"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="planetData.js"></script>
    <script>
        async function loadPlanetData(planetName, targetPrefix) {
            try {
                const data = await window.PlanetData.fetchPlanetData(planetName, targetPrefix);
                updateDisplay(data, planetName, targetPrefix);
            } catch (error) {
                console.error("Error loading planet data:", error);
                if (targetPrefix === 'planet') {
                    document.getElementById("planet-abstract-info").innerHTML =
                        "<p class='text-red-500 text-center'>Failed to fetch data.</p>";
                }
            }
        }

        function updateDisplay(data, planetName, targetPrefix) {
            if (targetPrefix === 'planet') {
                updateMainPlanetDisplay(data, planetName);
                document.getElementById("planet-name").textContent = data.label;
                document.getElementById("planet-temp-title").textContent = `${data.label} Temperature`;
                document.getElementById("planet-table-header").textContent = data.label;
            }
            updateTemperatureDisplay(data.temperatures, targetPrefix);
            window.PlanetData.updateComparisonTable();
        }

        function updateMainPlanetDisplay(data, planetName) {
            const imageContainerId = 'planet-image-container';
            document.getElementById("planet-abstract-info").innerHTML = `
                <div class="flex flex-col md:flex-row gap-6 items-start mb-6">
                    <div id="${imageContainerId}" class="md:w-1/3 flex-shrink-0">
                        <div class="rounded-lg shadow-lg overflow-hidden bg-black">
                            <!-- Image will be placed here -->
                        </div>
                        ${window.PlanetData.generateExternalLinksHTML(data.externalLinks)}
                    </div>
                    <div class="md:w-2/3">
                        <p class="text-gray-700">${data.abstract}</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="bg-blue-50 p-4 rounded-md">
                        <h3 class="font-semibold mb-2">Satellites</h3>
                        ${data.satellites.length > 0 ?
                    `<ul class="list-disc list-inside">
                                ${data.satellites.map(sat =>
                        `<li><a href="?planetName=${sat.replace(/ /g, '_')}" 
                                            class="text-blue-600 hover:text-blue-800 hover:underline">${sat}</a></li>`
                    ).join('')}
                            </ul>` :
                    '<p class="text-gray-600">No satellites found</p>'
                }
                    </div>
                    <div class="bg-blue-50 p-4 rounded-md">
                        <h3 class="font-semibold mb-2">Orbits Around</h3>
                        ${data.parentBodies.length > 0 ?
                    `<ul class="list-disc list-inside">
                                ${data.parentBodies.map(body =>
                        `<li><a href="?planetName=${body.replace(/ /g, '_')}" 
                                            class="text-blue-600 hover:text-blue-800 hover:underline">${body}</a></li>`
                    ).join('')}
                            </ul>` :
                    '<p class="text-gray-600">No parent bodies found</p>'
                }
                    </div>
                </div>
            `;

            // Load the image asynchronously
            if (window.wikiImagePromise) {
                window.wikiImagePromise.then(wikiImage => {
                    if (wikiImage) {
                        document.getElementById(imageContainerId).querySelector('.rounded-lg').innerHTML = `
                            <img src="${wikiImage}" alt="${planetName}" class="w-full h-auto">
                        `;
                    }
                });
            }
        }

        function updateTemperatureDisplay(temperatures, targetPrefix) {
            document.getElementById(`${targetPrefix}-temperature-info`).innerHTML = `
                <div class="bg-blue-100 p-4 rounded-md shadow-md">
                    ${(!temperatures.min && !temperatures.mean && !temperatures.max) ?
                    `<p class="text-center text-gray-600 italic mb-4">No temperature data available</p>` :
                    `<div class="relative w-full mt-4">
                        <div class="temperature-bar"></div>
                        ${temperatures.min !== null ?
                        `<div class="temp-marker" style="left: ${window.PlanetData.tempToPercent(temperatures.min)}%"></div>` : ''}
                        ${temperatures.mean !== null ?
                        `<div class="temp-marker" style="left: ${window.PlanetData.tempToPercent(temperatures.mean)}%"></div>` : ''}
                        ${temperatures.max !== null ?
                        `<div class="temp-marker" style="left: ${window.PlanetData.tempToPercent(temperatures.max)}%"></div>` : ''}
                        
                        <div class="temp-scale">
                            ${[0, 100, 200, 300, 400, 500].map(temp => `
                                <div class="temp-scale-mark" style="left: ${(temp / 500) * 100}%"></div>
                                <div class="temp-scale-label" style="left: ${(temp / 500) * 100}%">${temp}K</div>
                            `).join('')}
                        </div>
                    </div>`
                }
                    <div class="mt-4">
                        <p><strong>Min:</strong> ${temperatures.min !== null ?
                    `${temperatures.min}K (${window.PlanetData.kelvinToCelsius(temperatures.min)}°C)` :
                    '<span class="text-gray-600 italic">Data missing</span>'}</p>
                        <p><strong>Mean:</strong> ${temperatures.mean !== null ?
                    `${temperatures.mean}K (${window.PlanetData.kelvinToCelsius(temperatures.mean)}°C)` :
                    '<span class="text-gray-600 italic">Data missing</span>'}</p>
                        <p><strong>Max:</strong> ${temperatures.max !== null ?
                    `${temperatures.max}K (${window.PlanetData.kelvinToCelsius(temperatures.max)}°C)` :
                    '<span class="text-gray-600 italic">Data missing</span>'}</p>
                    </div>
                </div>
            `;
        }

        // Load data when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const planetName = urlParams.get('planetName') || 'Earth';

            // Load data for both the selected planet and Earth (for comparison)
            loadPlanetData(planetName, 'planet');
            loadPlanetData('Earth', 'earth');
        });
    </script>
</body>

</html>